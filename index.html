<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KEV</title>

    <!-- Critical Preloader CSS Inline -->
    <style>
      #preloader {
        position: fixed;
        inset: 0;
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.8s ease;
      }
      .wave-loading {
        font-family: "Inter", sans-serif;
        font-size: 2rem;
        color: white;
      }
    </style>

    <!-- Optimized Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet" />

    <!-- Font Awesome (deferred) -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
      media="all" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="/css/style.css" />

    <!-- Language Redirection Script -->
    <script>
      (async function () {
        const path = window.location.pathname;
        const urlParams = new URLSearchParams(window.location.search);

        if (
          (path === "/" || path === "/index.html") &&
          !urlParams.has("lang-redirect")
        ) {
          const supportedLanguages = ["en", "it"];
          const userLang = (navigator.language || "en")
            .slice(0, 2)
            .toLowerCase();
          const finalLang = supportedLanguages.includes(userLang)
            ? userLang
            : "en";

          const tryRedirect = async (lang) => {
            try {
              const response = await fetch(`/${lang}/index.html`, {
                method: "HEAD",
              });
              if (response.ok) {
                window.location.href = `/${lang}/?lang-redirect=true`;
                return true;
              }
            } catch (err) {}
            return false;
          };

          const redirected = await tryRedirect(finalLang);
          if (!redirected) {
            const fallbackRedirected = await tryRedirect("en");
            if (!fallbackRedirected) {
              window.location.href = "/404.html";
            }
          }
        }
      })();
    </script>

    <!-- No-JS Fallback -->
    <noscript>
      <meta http-equiv="refresh" content="0; url=/en/" />
    </noscript>
  </head>

  <body>
    <div id="preloader">
      <div class="wave-loading" aria-label="Loading...">
        <span>{</span>
        <span>K</span>
        <span>}</span>
        <span>E</span>
        <span>V</span>
      </div>
    </div>

    <!-- Preloader Fade-Out -->
    <script>
      window.addEventListener("load", () => {
        const preloader = document.getElementById("preloader");
        setTimeout(() => {
          preloader.style.opacity = "0";
          preloader.style.pointerEvents = "none";
          setTimeout(() => preloader.remove(), 800);
        }, 1000);
      });
    </script>

    <!-- GSAP Scripts (Deferred) -->
    <script src="https://unpkg.com/gsap@3/dist/gsap.min.js" defer></script>
    <script
      src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"
      defer></script>
    <script src="/javascript/main.js" defer></script>
  </body>
</html>
